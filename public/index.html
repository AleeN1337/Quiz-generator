<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Generator Quizów</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
      }
      .quiz-item {
        margin-bottom: 30px;
        padding: 10px;
        border-bottom: 1px solid #ccc;
      }
      button {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Generator Quizów</h1>

    <textarea
      id="sourceText"
      rows="6"
      cols="80"
      placeholder="Wklej tekst źródłowy..."
    ></textarea>
    <br /><br />

    <label for="quizType">Typ quizu:</label>
    <select id="quizType">
      <option value="open-ended">Pytania otwarte</option>
      <option value="multiple-choice">Wielokrotny wybór</option>
    </select>

    <button onclick="generateQuiz()">Generuj quiz</button>

    <hr />

    <div id="quizContainer"></div>

    <script>
      async function generateQuiz() {
        const sourceText = document.getElementById("sourceText").value;
        const quizType = document.getElementById("quizType").value;

        const response = await fetch("/generate-quiz", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ sourceText, quizType }),
        });

        const data = await response.json();
        const container = document.getElementById("quizContainer");
        container.innerHTML = "";

        if (data.quiz && Array.isArray(data.quiz.questions)) {
          data.quiz.questions.forEach((q, index) => {
            const div = document.createElement("div");
            div.className = "quiz-item";

            let html = `<strong>Pytanie ${index + 1}:</strong> ${
              q.question
            }<br>`;

            if (q.options && Array.isArray(q.options)) {
              html += `<ul>${q.options
                .map((opt) => `<li>${opt}</li>`)
                .join("")}</ul>`;

              const correctLetter = q.correctAnswer || "";
              const correctOption =
                q.options.find((opt) =>
                  opt.trim().startsWith(correctLetter + ".")
                ) || correctLetter;

              html += `<button onclick="document.getElementById('ans-${index}').style.display='block'">Pokaż odpowiedź</button>`;
              html += `<div id="ans-${index}" style="display:none; margin-top:5px;"><strong>Odpowiedź:</strong> ${correctOption}</div>`;
            } else {
              const openAnswer = q.answer || "brak odpowiedzi";

              html += `<button onclick="document.getElementById('ans-${index}').style.display='block'">Pokaż odpowiedź</button>`;
              html += `<div id="ans-${index}" style="display:none; margin-top:5px;"><strong>Odpowiedź:</strong> ${openAnswer}</div>`;
            }

            div.innerHTML = html;
            container.appendChild(div);
          });
        } else {
          container.innerHTML = `<p style="color:red">Nie udało się wygenerować quizu.</p>`;
        }
      }
    </script>
  </body>
</html>
